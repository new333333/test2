<?xml version="1.0"?>

<project name="wsclient" basedir="." default="testRun">
	<target name="init">
		<echo message="##### WSCLIENT #####" />
		<property environment="env" />
  		<property name="project.dir" value="../.." />
  		<property file="${project.dir}/build.${user.name}.properties" />
  		<property file="${project.dir}/build.properties" />
		<property name="generated.dir" value="${basedir}/generated" />
		<path id="project.classpath">
			<pathelement path="${classpath}" />
			<fileset dir="${project.dir}/lib" includes="*.jar" />
		</path>
		<taskdef resource="axis-tasks.properties" classpathref="project.classpath"/>
	</target>

	<target name="clean" depends="init">
		<delete includeEmptyDirs="true" failonerror="false">
			<fileset dir="${classes.dir}" excludes="${classes.dir.excludes}" />
		</delete>
	</target>

	<target name="compile" depends="init">
		<mkdir dir="${classes.dir}" />
		<javac
			classpathref="project.classpath"
			compiler="${javac.compiler}"
			debug="${javac.debug}"
			deprecation="${javac.deprecation}"
			destdir="${classes.dir}"
			fork="${javac.fork}"
			memoryMaximumSize="${javac.memoryMaximumSize}"
			nowarn="${javac.nowarn}">
			<src path="${source.dir}" />
			<src path="${generated.dir}" />
		</javac>
	</target>
	
	<target name="testRun" depends="compile">
		<java 
			classname="com.sitescape.ef.samples.wsclient.MyFacadeClient"
			classpath="${classes.dir}"
			fork="true"
			dir="${basedir}"
			failonerror="true">
			<jvmarg value="-Daxis.ClientConfigFile=client_deploy.wsdd"/>
			<arg value="74"/>
			<arg value="491"/>
			<!-- Use explicit path elements rather than picking up everything
			     in the lib directory so that we can - for documentation 
			     purpose - see what archive files are needed on the client
			     side -->
			<classpath>
				<pathelement path="${classpath}" />
				<pathelement location="${project.dir}/lib/spring.jar" />
				<pathelement location="${project.dir}/lib/axis.jar" />
				<pathelement location="${project.dir}/lib/jaxrpc.jar" />
				<pathelement location="${project.dir}/lib/commons-logging.jar" />
				<pathelement location="${project.dir}/lib/commons-discovery.jar" />
				<pathelement location="${project.dir}/lib/saaj.jar" />
				<pathelement location="${project.dir}/lib/wsdl4j.jar" />
				<pathelement location="${project.dir}/lib/wss4j.jar" />
				<pathelement location="${project.dir}/lib/addressing.jar" />
				<pathelement location="${project.dir}/lib/bcprov-jdk13-128.jar.jar" />
				<pathelement location="${project.dir}/lib/commons-codec.jar" />
				<pathelement location="${project.dir}/lib/opensaml.jar" />
				<pathelement location="${project.dir}/lib/xalan.jar" />
				<pathelement location="${project.dir}/lib/xmlsec.jar" />
			</classpath>
		</java>
	</target>
	
	<target name="testRun2" depends="compile">
		<java 
			classname="com.sitescape.ef.samples.wsclient.MyGeneratedFacadeClient"
			classpath="${classes.dir}"
			classpathref="project.classpath"
			fork="true"
			dir="${basedir}"
			failonerror="true">
			<jvmarg value="-Daxis.ClientConfigFile=client_deploy.wsdd"/>
			<arg value="74"/>
			<arg value="491"/>
		</java>
	</target>
	
	<target name="wsdl2java" depends="init" description="Generate client service bindings from WSDL">
		<axis-wsdl2java
			output="${generated.dir}"
			verbose="true"
			url="http://peace:8080/ssf/ws/Facade?wsdl" >
			<mapping
				namespace="http://localhost:8080/ssf/ws/Facade"
				package="com.sitescape.ef.samples.wsclient" />
		</axis-wsdl2java>
	</target>
	
</project>