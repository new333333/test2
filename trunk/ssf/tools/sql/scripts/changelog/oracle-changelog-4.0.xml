<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
    <changeSet author="jong" context="schema" failOnError="true" id="1">
        <comment>Size limit for any attachment in an email message</comment>
        <addColumn tableName="SS_ZONECONFIG">
            <column name="OUTGOINGATTACHMENTSIZELIMIT" type="NUMBER(19,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="2">
        <comment>Size limit for the sum of all attachments in an email message</comment>
        <addColumn tableName="SS_ZONECONFIG">
            <column name="OUTGOINGATTACHMENTSUMLIMIT" type="NUMBER(19,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="peter" context="schema" failOnError="true" id="3">
        <comment>The binder owning this local template</comment>
        <addColumn tableName="SS_FORUMS">
            <column name="TEMPLATEOWNINGBINDERID" type="NUMBER(19,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="peter" context="schema" failOnError="true" id="4">
        <createIndex indexName="TEMPLATEOWNINGBINDERID_BINDER" tableName="SS_FORUMS" unique="false">
            <column name="TEMPLATEOWNINGBINDERID"/>
        </createIndex>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="5">
        <comment>XML document stored as compressed bytes</comment>
        <addColumn tableName="SS_CHANGELOGS">
            <column name="XMLBYTES" type="BLOB">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="6">
        <comment>Identity source type for provisioned users</comment>
        <addColumn tableName="SS_PRINCIPALS">
            <column name="IDENTITYSOURCE" type="NUMBER(10,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="peter" context="schema" failOnError="true" id="7">
        <createTable tableName="SS_RESOURCEDRIVER">
            <column name="ID" type="NUMBER(19,0)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SS_RESOURCEDRIVER"/>
            </column>
            <column name="ZONEID" type="NUMBER(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="NAME" type="VARCHAR2(64 CHAR)"/>
            <column name="TYPE" type="NUMBER(10,0)"/>
            <column name="READONLY" type="NUMBER(1,0)"/>
            <column name="SYNCHTOPDELETE" type="NUMBER(1,0)"/>
            <column name="PUTREQUIRESCONTENTLENGTH" type="NUMBER(1,0)"/>
            <column name="ALLOWSELFSIGNEDCERTIFICATE" type="NUMBER(1,0)"/>
            <column name="HOSTURL" type="VARCHAR2(255)"/>
            <column name="ROOTPATH" type="VARCHAR2(1024)"/>
            <column name="ACCOUNTNAME" type="VARCHAR2(255 CHAR)"/>
            <column name="PASSWORD" type="VARCHAR2(255 CHAR)"/>
        </createTable>
    </changeSet>
    <changeSet author="peter" context="schema" failOnError="true" id="8">
        <addColumn tableName="SS_RESOURCEDRIVER">
            <column name="shareName" type="VARCHAR2(255 CHAR)">
            	<constraints nullable="true" />
            </column>
        </addColumn>
        <addColumn tableName="SS_RESOURCEDRIVER">
            <column name="serverName" type="VARCHAR2(255 CHAR)">
            	<constraints nullable="true" />
            </column>
        </addColumn>
        <addColumn tableName="SS_RESOURCEDRIVER">
            <column name="serverIP" type="VARCHAR2(255 CHAR)">
            	<constraints nullable="true" />
            </column>
        </addColumn>
        <addColumn tableName="SS_RESOURCEDRIVER">
            <column name="volume" type="VARCHAR2(255 CHAR)">
            	<constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="9">
        <comment>Enable external users</comment>
        <addColumn tableName="SS_ZONECONFIG">
            <column name="EXTERNALUSERENABLED" type="NUMBER(1,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Enable OpenID authentication</comment>
        <addColumn tableName="SS_ZONECONFIG">
            <column name="OPENIDAUTHENTICATIONENABLED" type="NUMBER(1,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Enable OpenID self-provisioning</comment>
        <addColumn tableName="SS_ZONECONFIG">
            <column name="OPENIDSELFPROVISIONINGENABLED" type="NUMBER(1,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>The mode in which OpenID user's profile information is synchronized</comment>
        <addColumn tableName="SS_ZONECONFIG">
            <column name="OPENIDPROFILESYNCMODE" type="NUMBER(10,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="10">
        <createTable tableName="SS_OPENIDPROVIDERS">
            <column name="ID" type="CHAR(32)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SS_OPENIDPROVIDERS"/>
            </column>
            <column name="ZONEID" type="NUMBER(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="NAME" type="VARCHAR2(64 CHAR)">
                <constraints nullable="false"/>
            </column>
            <column name="TITLE" type="VARCHAR2(128 CHAR)">
                <constraints nullable="false"/>
            </column>
            <column name="URL" type="VARCHAR2(256 CHAR)">
                <constraints nullable="false"/>
            </column>
            <column name="REGEX" type="VARCHAR2(256 CHAR)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="11">
        <createIndex indexName="NAME_OPENIDPROVIDERS" tableName="SS_OPENIDPROVIDERS" unique="true">
            <column name="ZONEID"/>
            <column name="NAME"/>
        </createIndex>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="12">
        <createTable tableName="SS_SHAREITEM">
            <column name="ID" type="NUMBER(19,0)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SS_SHAREITEM"/>
            </column>
            <column name="ZONEID" type="NUMBER(19,0)"/>
            <column name="LATEST" type="NUMBER(1,0)"/>
            <column name="SHARERID" type="NUMBER(19,0)"/>
            <column name="SHAREDENTITY_TYPE" type="NUMBER(10,0)"/>
            <column name="SHAREDENTITY_ID" type="NUMBER(19,0)"/>
            <column name="COMMENT" type="VARCHAR2(255 CHAR)"/>
            <column name="DAYSTOEXPIRE" type="NUMBER(10,0)"/>
            <column name="STARTDATE" type="TIMESTAMP(6)"/>
            <column name="ENDDATE" type="TIMESTAMP(6)"/>
            <column name="RECIPIENT_TYPE" type="NUMBER(2,0)"/>
            <column name="RECIPIENT_ID" type="NUMBER(19,0)"/>
            <column name="EXPIRATIONHANDLED" type="NUMBER(1,0)"/>
            <column name="RIGHT_CREATEENTRIES" type="NUMBER(1,0)"/>
            <column name="RIGHT_MODIFYENTRIES" type="NUMBER(1,0)"/>
            <column name="RIGHT_MODIFYENTRYFIELDS" type="NUMBER(1,0)"/>
            <column name="RIGHT_DELETEENTRIES" type="NUMBER(1,0)"/>
            <column name="RIGHT_READENTRIES" type="NUMBER(1,0)"/>
            <column name="RIGHT_ADDREPLIES" type="NUMBER(1,0)"/>
            <column name="RIGHT_GENERATEREPORTS" type="NUMBER(1,0)"/>
            <column name="RIGHT_BINDERADMINISTRATION" type="NUMBER(1,0)"/>
            <column name="RIGHT_CREATEENTRYACLS" type="NUMBER(1,0)"/>
            <column name="RIGHT_CHANGEACCESSCONTROL" type="NUMBER(1,0)"/>
            <column name="RIGHT_CREATEWORKSPACES" type="NUMBER(1,0)"/>
            <column name="RIGHT_CREATEFOLDERS" type="NUMBER(1,0)"/>
            <column name="RIGHT_MANAGEENTRYDEFS" type="NUMBER(1,0)"/>
            <column name="RIGHT_MANAGEWORKFLOWDEFS" type="NUMBER(1,0)"/>
            <column name="RIGHT_CREATORREADENTRIES" type="NUMBER(1,0)"/>
            <column name="RIGHT_CREATORMODIFYENTRIES" type="NUMBER(1,0)"/>
            <column name="RIGHT_CREATORDELETEENTRIES" type="NUMBER(1,0)"/>
            <column name="RIGHT_OWNERCREATEENTRYACLS" type="NUMBER(1,0)"/>
            <column name="RIGHT_ADDTAGS" type="NUMBER(1,0)"/>
            <column name="RIGHT_VIEWBINDERTITLE" type="NUMBER(1,0)"/>
            <column name="RIGHT_ALLOWSHARING" type="NUMBER(1,0)"/>
        </createTable>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="13">
        <createIndex indexName="SHARERID_SHAREITEM" tableName="SS_SHAREITEM" unique="false">
            <column name="SHARERID"/>
        </createIndex>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="14">
        <createIndex indexName="STARTDATE_SHAREITEM" tableName="SS_SHAREITEM" unique="false">
            <column name="STARTDATE"/>
        </createIndex>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="15">
        <createIndex indexName="ENDDATE_SHAREITEM" tableName="SS_SHAREITEM" unique="false">
            <column name="ENDDATE"/>
        </createIndex>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="16">
        <createIndex indexName="SHAREDENTITY_SHAREITEM" tableName="SS_SHAREITEM" unique="false">
            <column name="SHAREDENTITY_TYPE"/>
            <column name="SHAREDENTITY_ID"/>
        </createIndex>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="17">
        <createIndex indexName="RECIPIENT_SHAREITEM" tableName="SS_SHAREITEM" unique="false">
            <column name="RECIPIENT_TYPE"/>
            <column name="RECIPIENT_ID"/>
        </createIndex>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="18">
        <createSequence sequenceName="SS_SHAREITEM_ID_SEQUENCE"/>
    </changeSet>
    <changeSet author="peter" context="schema" failOnError="true" id="19">
        <comment>Count of OpenId user accounts</comment>
        <addColumn tableName="SS_LICENSESTATS">
            <column name="OPENIDUSERCOUNT" type="NUMERIC(19,0)">
              <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="peter" context="schema" failOnError="true" id="20">
        <addColumn tableName="SS_RESOURCEDRIVER">
			<column name="modifiedOn" type="TIMESTAMP(6)">
				<constraints nullable="true" />
			</column>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="21">
        <addColumn tableName="SS_FORUMS">
			<column name="EXTFUNCTIONMEMBERSHIPINHERITED" type="NUMBER(1,0)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="22">
        <addColumn tableName="SS_FOLDERENTRIES">
			<column name="HASENTRYEXTERNALACL" type="NUMBER(1,0)"/>
        </addColumn>
    </changeSet>
    <changeSet author="peter" context="schema" failOnError="true" id="23">
        <addColumn tableName="SS_FORUMS">
			<column name="TEMPLATEHIDDEN" type="NUMBER(1,0)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="24">
        <addColumn tableName="SS_PRINCIPALS">
			<column name="OBJECTSID" type="VARCHAR2(128 CHAR)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="25">
        <createIndex indexName="OBJECTSID_PRINCIPAL" tableName="SS_PRINCIPALS" unique="false">
            <column name="OBJECTSID"/>
        </createIndex>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="26">
        <addColumn tableName="SS_PRINCIPALS">
			<column name="SAMACCOUNTNAME" type="VARCHAR2(128 CHAR)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="27">
        <addColumn tableName="SS_FORUMS">
			<column name="HOMEDIR" type="NUMBER(1,0)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="28">
        <addColumn tableName="SS_ZONECONFIG">
			<column name="LOCALELANGUAGE" type="VARCHAR2(16 CHAR)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="29">
        <addColumn tableName="SS_ZONECONFIG">
			<column name="LOCALECOUNTRY" type="VARCHAR2(16 CHAR)"/>
        </addColumn>
    </changeSet>
    <changeSet author="david" context="schema" failOnError="true" id="30">
        <addColumn tableName="SS_ATTACHMENTS">
			<column name="FILEMD5" type="CHAR(32)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="31">
        <addColumn tableName="SS_PRINCIPALS">
			<column name="INTERNAL" type="NUMBER(1,0)"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="jong" context="schema" failOnError="true" id="32">
        <addColumn tableName="SS_PRINCIPALS">
			<column name="FROMLDAP" type="NUMBER(1,0)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="33">
        <addColumn tableName="SS_PRINCIPALS">
			<column name="FROMLOCAL" type="NUMBER(1,0)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jong" context="schema" failOnError="true" id="34">
        <addColumn tableName="SS_PRINCIPALS">
			<column name="FROMOPENID" type="NUMBER(1,0)"/>
        </addColumn>
    </changeSet>
    
    
    <changeSet author="jay" context="schema" failOnError="true" id="35">
        <comment>Enable adhoc file folders in users personal workspace</comment>
        <addColumn tableName="SS_ZONECONFIG">
            <column name="ADHOCFOLDERSENABLED" type="NUMBER(1,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet author="jong" context="data" failOnError="true" id="36">
        <sql>
update SS_PRINCIPALS set INTERNAL=0,FROMLDAP=0,FROMLOCAL=0,FROMOPENID=1 where IDENTITYSOURCE=11;
update SS_PRINCIPALS set INTERNAL=1,FROMLDAP=0,FROMLOCAL=1,FROMOPENID=0 where IDENTITYSOURCE=1;
update SS_PRINCIPALS set INTERNAL=1,FROMLDAP=1,FROMLOCAL=0,FROMOPENID=0 where IDENTITYSOURCE=2;
update SS_PRINCIPALS set INTERNAL=1,FROMLDAP=0,FROMLOCAL=1,FROMOPENID=0 where IDENTITYSOURCE is null and NAME = FOREIGNNAME;
update SS_PRINCIPALS set INTERNAL=1,FROMLDAP=1,FROMLOCAL=0,FROMOPENID=0 where IDENTITYSOURCE is null and NAME != FOREIGNNAME;            
        </sql>
    </changeSet>

    <changeSet author="jong" context="schema" failOnError="true" id="37">
	    <addNotNullConstraint tableName="SS_PRINCIPALS" columnName="INTERNAL" columnDataType="NUMBER(1,0)"/>
    </changeSet>
    
    <changeSet author="jong" context="schema" failOnError="true" id="38">
	    <addNotNullConstraint tableName="SS_PRINCIPALS" columnName="FROMLDAP" columnDataType="NUMBER(1,0)"/>
    </changeSet>
    
    <changeSet author="jong" context="schema" failOnError="true" id="39">
	    <addNotNullConstraint tableName="SS_PRINCIPALS" columnName="FROMLOCAL" columnDataType="NUMBER(1,0)"/>
    </changeSet>
    
    <changeSet author="jong" context="schema" failOnError="true" id="40">
	    <addNotNullConstraint tableName="SS_PRINCIPALS" columnName="FROMOPENID" columnDataType="NUMBER(1,0)"/>
    </changeSet>    
    
    <changeSet author="jay" context="schema" failOnError="true" id="41">
        <comment>Is deployment of the Desktop application enabled</comment>
        <addColumn tableName="SS_ZONECONFIG">
            <column name="FSADEPLOYENABLED" type="NUMBER(1,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet author="jong" context="schema" failOnError="true" id="42">
        <comment>How many days worth of data to keep in SS_AuditTrail table</comment>
        <addColumn tableName="SS_ZONECONFIG">
            <column name="AUDITTRAILKEEPDAYS" type="NUMBER(10,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet author="jong" context="schema" failOnError="true" id="43">
        <comment>How many days worth of data to keep in SS_ChangeLogs table</comment>
        <addColumn tableName="SS_ZONECONFIG">
            <column name="CHANGELOGSKEEPDAYS" type="NUMBER(10,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet author="peter" context="schema" failOnError="true" id="44">
        <addColumn tableName="SS_SHAREITEM">
			<column name="allowSharingExternal" type="NUMBER(1,0)"/>
			<column name="allowSharingPublic" type="NUMBER(1,0)"/>
        </addColumn>
    </changeSet>
</databaseChangeLog>