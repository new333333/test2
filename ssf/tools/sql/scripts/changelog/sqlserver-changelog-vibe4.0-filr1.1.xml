<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
    <changeSet author="dennis" context="schema" failOnError="true" id="1">
        <comment>Is a user's workspace in the trash?</comment>
        <addColumn tableName="SS_Principals">
            <column name="workspacePreDeleted" type="TINYINT">
              <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet author="jong" context="schema" failOnError="true" id="2">
        <comment>Full sync stop requested</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSyncStopRequested" type="TINYINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Full sync status</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_status" type="VARCHAR(16)">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Full sync start time</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_startDate" type="DATETIME">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Full sync end time</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_endDate" type="DATETIME">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Process directory only</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_dirOnly" type="TINYINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Directory enumeration failed</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_enumFailed" type="TINYINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of files encountered</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFiles" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of files added</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFileAdd" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of files expunged</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFileExpunge" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of files modified</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFileModify" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of files for which ACLs are set</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFileSetAcl" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of files for which ownership are set</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFileSetOwner" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of folders encountered</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFolders" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of folders added</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFolderAdd" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of folders expunged</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFolderExpunge" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of folders for which ACLs are set</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFolderSetAcl" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of folders for which ownership are set</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFolderSetOwner" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of dangling entries expunged</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countEntryExpunge" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of failure</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFailure" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Count of folders processed</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFolderProcessed" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <comment>Largest count of folders found in queue at once</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_countFolderMaxQueue" type="INT">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet author="jong" context="schema" failOnError="true" id="3">
        <comment>Full sync status set time</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_statusDate" type="DATETIME">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet author="jong" context="schema" failOnError="true" id="4">
        <createIndex indexName="statusDate_binderState" schemaName="dbo" tableName="SS_BinderState" unique="false">
            <column name="fullSync_statusDate"/>
        </createIndex>
    </changeSet>
    
    <changeSet author="jong" context="schema" failOnError="true" id="5">
        <comment>IPv4 address of the node from which full sync status is set</comment>
        <addColumn tableName="SS_BinderState">
            <column name="fullSync_statusIpv4Address" type="VARCHAR(16)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet author="jong" context="schema" failOnError="true" id="6">
        <comment>Whether or not full sync should only process directories</comment>
        <addColumn tableName="SS_Forums">
            <column name="fullSyncDirOnly" type="TINYINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
	</changeSet>

    <changeSet author="peter" context="schema" failOnError="true" id="7">
        <addColumn tableName="SS_ShareItem">
			<column name="right_creatorRenameEntries" type="TINYINT"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="peter" context="schema" failOnError="true" id="9">
        <comment>Is audit trail logging enabled and change log enabled</comment>
        <addColumn tableName="SS_ZoneConfig">
            <column name="auditTrailEnabled" type="TINYINT">
                <constraints nullable="true" />
            </column>
            <column name="changeLogEnabled" type="TINYINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet author="peter" context="schema" failOnError="true" id="10">
        <comment>Is audit trail logging enabled and change log enabled</comment>
        <addColumn tableName="SS_ZoneConfig">
            <column name="fileArchivingEnabled" type="TINYINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet author="peter" context="schema" failOnError="true" id="11">
        <comment>The binder containing entries to be copied when folder created</comment>
        <addColumn tableName="SS_Forums">
            <column name="templateEntrySourceBinderId" type="NUMERIC(19,0)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet author="jong" context="schema" failOnError="true" id="12">
        <comment>Reindexing start date</comment>
        <addColumn tableName="SS_IndexNode">
            <column name="reindexingStartDate" type="DATETIME">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet author="jong" context="schema" failOnError="true" id="13">
        <comment>Reindexing end date</comment>
        <addColumn tableName="SS_IndexNode">
            <column name="reindexingEndDate" type="DATETIME">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet author="dennis" context="schema" failOnError="true" id="14">
        <comment>Is deployment of the Desktop application done from local files</comment>
        <addColumn tableName="SS_ZoneConfig">
            <column name="fsaDeployLocalApps" type="TINYINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet author="jong" context="schema" failOnError="true" id="15">
        <comment>IPv4 address of the node on which reindexing started</comment>
        <addColumn tableName="SS_IndexNode">
            <column name="reindexingIpv4Address" type="VARCHAR(16)">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet author="jay" context="schema" failOnError="true" id="16">
        <comment>Net Folder sync schedule option</comment>
        <addColumn tableName="SS_Forums">
            <column name="syncScheduleOption" type="SMALLINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet author="dennis" context="schema" failOnError="true" id="17">
        <comment>My Files Storage folder marker.</comment>
        <addColumn tableName="SS_Forums">
			<column name="myFilesDir" type="TINYINT"/>
        </addColumn>
    </changeSet>

    <changeSet author="dennis" context="schema" failOnError="true" id="18">
        <comment>Sharing - Whitelist/Blacklist.</comment>
        <addColumn tableName="SS_ZoneConfig">
			<column name="shareListsBlob" type="image"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="dennis" context="schema" failOnError="true" id="19">
        <comment>Enable users to download files</comment>
        <addColumn tableName="SS_ZoneConfig">
            <column name="downloadEnabled" type="TINYINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <addColumn tableName="SS_Principals">
            <column name="downloadEnabled" type="TINYINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet author="dennis" context="schema" failOnError="true" id="20">
        <comment>Enable users to use web access</comment>
        <addColumn tableName="SS_ZoneConfig">
            <column name="webAccessEnabled" type="TINYINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <addColumn tableName="SS_Principals">
            <column name="webAccessEnabled" type="TINYINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
    </changeSet>
    
</databaseChangeLog>
