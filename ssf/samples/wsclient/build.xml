<?xml version="1.0"?>

<project name="wsclient" basedir="." default="usage">
	<property name="project.dir" value="../.." />
	<property name="generated.dir" value="${basedir}/generated" />

	<property name="remotingclient.zip.file" value="remotingclient-sample.zip"/>

	<import file="${project.dir}/build-common.xml"/>

	<!-- This overrides the imported definition -->
	<path id="project.classpath">
		<pathelement path="${classes.dir};${project.dir}/util/classes;" />
		<pathelement location="${project.dir}/ws-client/ssf-wsclient.jar" />
		<pathelement location="${project.dir}/lib/activation.jar" />
		<pathelement location="${project.dir}/lib/mail.jar" />
		<pathelement location="${project.dir}/lib/dom4j.jar" />
		<pathelement location="${project.dir}/lib/axis.jar" />
		<pathelement location="${project.dir}/lib/axis-ant.jar" />
		<pathelement location="${project.dir}/lib/jaxrpc.jar" />
		<pathelement location="${project.dir}/lib/commons-httpclient.jar" />
		<pathelement location="${project.dir}/lib/commons-logging.jar" />
		<pathelement location="${project.dir}/lib/commons-discovery.jar" />
		<pathelement location="${project.dir}/lib/commons-codec.jar" />
		<pathelement location="${project.dir}/lib/saaj.jar" />
		<pathelement location="${project.dir}/lib/wsdl4j.jar" />
		<pathelement location="${project.dir}/lib/wss4j.jar" />
		<pathelement location="${project.dir}/lib/addressing.jar" />
		<pathelement location="${project.dir}/lib/bcprov-jdk15.jar" />
		<pathelement location="${project.dir}/lib/opensaml.jar" />
		<pathelement location="${project.dir}/lib/xalan.jar" />
		<pathelement location="${project.dir}/lib/xmlsec.jar" />
		<pathelement location="${project.dir}/lib/jaxen.jar" />
	</path>

	<target name="usage">
		<echo message="zip" />
		<echo message="readDefinitionGenerated" />
		<echo message="readDefinitionConfigGenerated" />
		<echo message="readBinderGenerated" />
		<echo message="readEntryGenerated" />
		<echo message="addEntryGenerated" />
		<echo message="uploadFileGenerated" />
	</target>
	
	<target name="clean">
		<delete includeEmptyDirs="true" failonerror="false">
			<fileset dir="${classes.dir}" excludes="${classes.dir.excludes}" />
		</delete>
	</target>
	
	<target name="cleanGenerated">
		<delete includeEmptyDirs="true" failonerror="false">
			<fileset dir="${generated.dir}" />
		</delete>
	</target>
	
	<target name="compile">
		<mkdir dir="${classes.dir}" />
		<javac
			classpathref="project.classpath"
			compiler="${javac.compiler}"
			debug="${javac.debug}"
			deprecation="${javac.deprecation}"
			destdir="${classes.dir}"
			fork="${javac.fork}"
			memoryMaximumSize="${javac.memoryMaximumSize}"
			nowarn="${javac.nowarn}">
			<src path="${source.dir}" />
			<src path="${generated.dir}" />
		</javac>
	</target>
	
	<!-- Similar to "compile" target except that this excludes all generated files
	     from compilation. Any program that uses generated files is also excluded. -->
	<target name="compileButGenerated">
		<mkdir dir="${classes.dir}" />
		<javac
			sourcepath="" 
			srcdir="${source.dir}"
			classpathref="project.classpath"
			compiler="${javac.compiler}"
			debug="${javac.debug}"
			deprecation="${javac.deprecation}"
			destdir="${classes.dir}"
			fork="${javac.fork}"
			memoryMaximumSize="${javac.memoryMaximumSize}"
			nowarn="${javac.nowarn}">
			<exclude name="**/jaxrpc/FacadeClient.java"/>
		</javac>
	</target>
	
	<target name="wsdl2java" depends="cleanGenerated" description="Generate client service bindings from WSDL">
		<delete dir="${generated.dir}" />
		<mkdir dir="${generated.dir}" />
		<axis-wsdl2java
			output="${generated.dir}"
			verbose="true"
			url="http://peace:8080/ssf/ws/Facade?wsdl" >
			<mapping
				namespace="http://peace:8080/ssf/ws/Facade"
				package="com.sitescape.team.samples.remoting.client.ws.jaxrpc" />
			<mapping
				namespace="urn:SSF"
				package="com.sitescape.team.samples.remoting.client.ws.jaxrpc" />
		</axis-wsdl2java>
	</target>
	
	<!-- THE FOLLOWING TARGETS ARE USED TO RUN SAMPLE PROGRAMS -->
	
	<target name="readDefinitionGenerated" depends="compile">
		<java 
			classname="com.sitescape.team.samples.remoting.client.ws.jaxrpc.FacadeClient"
			classpath="${classes.dir}"
			classpathref="project.classpath"
			fork="true"
			dir="${basedir}"
			failonerror="true">
			<jvmarg value="-Daxis.ClientConfigFile=client_deploy.wsdd"/>
			<arg value="readDefinition"/>
			<!-- id of "discussion" definition -->
			<arg value="402883cc0c10eb75010c10fa9f970002"/>
		</java>
	</target>
	
	<target name="readDefinitionConfigGenerated" depends="compile">
		<java 
			classname="com.sitescape.team.samples.remoting.client.ws.jaxrpc.FacadeClient"
			classpath="${classes.dir}"
			classpathref="project.classpath"
			fork="true"
			dir="${basedir}"
			failonerror="true">
			<jvmarg value="-Daxis.ClientConfigFile=client_deploy.wsdd"/>
			<arg value="readDefinitionConfig"/>
		</java>
	</target>
	
	<target name="readBinderGenerated" depends="compile">
		<java 
			classname="com.sitescape.team.samples.remoting.client.ws.jaxrpc.FacadeClient"
			classpath="${classes.dir}"
			classpathref="project.classpath"
			fork="true"
			dir="${basedir}"
			failonerror="true">
			<jvmarg value="-Daxis.ClientConfigFile=client_deploy.wsdd"/>
			<arg value="readBinder"/>
			<arg value="74"/>
		</java>
	</target>
	
	<target name="readEntryGenerated" depends="compile">
		<java 
			classname="com.sitescape.team.samples.remoting.client.ws.jaxrpc.FacadeClient"
			classpath="${classes.dir}"
			classpathref="project.classpath"
			fork="true"
			dir="${basedir}"
			failonerror="true">
			<jvmarg value="-Daxis.ClientConfigFile=client_deploy.wsdd"/>
			<arg value="readEntry"/>
			<arg value="74"/>
			<arg value="556"/>
		</java>
	</target>
	
	<target name="addEntryGenerated" depends="compile">
		<java 
			classname="com.sitescape.team.samples.remoting.client.ws.jaxrpc.FacadeClient"
			classpath="${classes.dir}"
			classpathref="project.classpath"
			fork="true"
			dir="${basedir}"
			failonerror="true">
			<jvmarg value="-Daxis.ClientConfigFile=client_deploy.wsdd"/>
			<arg value="addEntry"/>
			<arg value="74"/>
			<!-- id of "discussion" definition -->
			<arg value="402883cc08da22a50108da5a83260002"/>
		</java>
	</target>
	
	<target name="uploadFileGenerated" depends="compile">
		<java 
			classname="com.sitescape.team.samples.remoting.client.ws.jaxrpc.FacadeClient"
			classpath="${classes.dir}"
			classpathref="project.classpath"
			fork="true"
			dir="${basedir}"
			failonerror="true">
			<jvmarg value="-Daxis.ClientConfigFile=client_deploy.wsdd"/>
			<arg value="uploadFile"/>
			<arg value="74"/>
			<arg value="482"/>
			<arg value="picture"/>
			<arg value="C:/junk/dog6.gif"/>
		</java>
	</target>
	
	<target name="readWorkspaceTreeGenerated" depends="compile">
		<java 
			classname="com.sitescape.team.samples.remoting.client.ws.jaxrpc.FacadeClient"
			classpath="${classes.dir}"
			classpathref="project.classpath"
			fork="true"
			dir="${basedir}"
			failonerror="true">
			<jvmarg value="-Daxis.ClientConfigFile=client_deploy.wsdd"/>
			<arg value="readWorkspaceTree"/>
			<!-- To fetch from top workspace down -->
			<arg value="1"/>
			<!-- To fetch from a folder down -->
			<!--<arg value="244"/>-->
			<!-- To fetch all -->
			<arg value="-1"/>
			<!-- To fetch only one level -->
			<!--<arg value="1"/>-->
		</java>
	</target>
	
	<target name="zip" depends="compileButGenerated">
		<delete dir="${basedir}/lib"/>
		<mkdir dir="${basedir}/lib"/>
		<copy file="${project.dir}/ws-client/ssf-wsclient.jar" todir="${basedir}/lib"/>
		<copy todir="${basedir}/lib">
			<fileset dir="${project.dir}/lib">
				<include name="activation.jar" />
				<include name="mail.jar" />
				<include name="dom4j.jar" />
				<include name="axis.jar" />
				<include name="axis-ant.jar" />
				<include name="jaxrpc.jar" />
				<include name="commons-httpclient.jar" />
				<include name="commons-logging.jar" />
				<include name="commons-discovery.jar" />
				<include name="saaj.jar" />
				<include name="wsdl4j.jar" />
				<include name="wss4j.jar" />
				<include name="addressing.jar" />
				<include name="bcprov-jdk13-128.jar" />
				<include name="commons-codec.jar" />
				<include name="opensaml.jar" />
				<include name="xalan.jar" />
				<include name="xmlsec.jar" />
			</fileset>
			<fileset dir="${project.dir}/tools">
				<include name="ssf-tools.jar" />
			</fileset>
			<fileset dir="${project.dir}/main">
				<include name="ssf-main.jar" />
			</fileset>
		</copy>
		<zip destfile="${project.dir}/samples/${remotingclient.zip.file}"
			basedir="${basedir}"
			includes="classes/**/*.class,src/**/*.java,*.bat,*.wsdd,readme.txt"
			excludes="classes/**/jaxrpc/*.class,src/**/jaxrpc/*.java"
		/>
		<zip destfile="${project.dir}/samples/${remotingclient.zip.file}"
			basedir="${project.dir}/util"
			includes="classes/**/PasswordEncryptor.class,src/**/PasswordEncryptor.java"
			update="true"
		/>
		<zip destfile="${project.dir}/samples/${remotingclient.zip.file}"
			basedir="${basedir}"
			includes="lib/*.*"
			update="true"
		/>
	</target>
</project>