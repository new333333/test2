<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

	<!-- Handler mapping implementation that maps from URLs to request handler beans -->
	<bean id="defaultHandlerMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="interceptors">
			<list>
				<!-- We do not need LoginCheckInterceptor here, because
				     1. Under Liferay, the login filter will redirect unauthenticated 
				     user to Liferay's login page.
				     1. Under JBoss Portal, all servlets require authentication first.
				     So in both cases, by the time these handlers are executed, we
				     can safely assume that the user has already been authenticated. -->
				<!-- Enable Open-Session-In-View pattern for Hibernate ORM.
				     Put this before other interceptors that might interact
				     with the database. --> 
				<ref bean="openSessionInViewInterceptor"/>
				<!-- Set up and resolve RequestContext -->
				<ref bean="initRequestContextInterceptor"/>
			</list>
		</property>
		<property name="urlMap">
			<map>
				<entry key="/viewFile"><ref local="viewFile"/></entry>
				<entry key="/viewFile/*"><ref local="viewFile"/></entry>
				<entry key="/viewiCal"><ref local="viewiCal"/></entry>				
				<entry key="/viewCss"><ref local="viewCss"/></entry>				
				<entry key="/viewDefinitionXml"><ref local="viewDefinitionXml"/></entry>				
				<entry key="/viewFragment"><ref local="viewFragment"/></entry>
				<entry key="/reportDownload"><ref local="reportDownload"/></entry>
				<entry key="/definitionDownload"><ref local="definitionDownload"/></entry>
				<entry key="/templateDownload"><ref local="templateDownload"/></entry>
				<entry key="/errorHandler"><ref local="errorHandler"/></entry>
				<entry key="/readFile"><ref local="readFile"/></entry>
				<entry key="/readFile/**/*"><ref local="readFile"/></entry>
				<entry key="/portalLogin"><ref local="portalLogin"/></entry>
				<entry key="/portalLogout"><ref local="portalLogin"/></entry>
			</map>
		</property>
	</bean>

	<bean id="initRequestContextInterceptor" class="com.sitescape.team.web.servlet.handler.InitRequestContextInterceptor">
		<property name="resolve"><value>true</value></property>
	</bean>

	<bean id="openSessionInViewInterceptor" class="org.springframework.orm.hibernate3.support.OpenSessionInViewInterceptor">
		<property name="sessionFactory"><ref bean="sessionFactory"/></property>
		<!--<property name="singleSession"><value>false</value></property>-->
	</bean>

	<!-- Handler Exception Resolver -->
	<bean id="handlerExceptionResolver" class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
		<property name="exceptionMappings">
			<props>
				<prop key="com.sitescape.team.exception.CheckedCodedException">common/servlet.defCodedError</prop>
				<prop key="com.sitescape.team.exception.UncheckedCodedException">common/servlet.defCodedError</prop>
			</props>
		</property>
		<property name="defaultErrorView"><value>common/defError</value></property>
	</bean>

	<!-- Controllers -->

	<bean id="viewFile" parent="dependOnAllModulesTemplate" class="com.sitescape.team.servlet.forum.ViewFileController">
		<property name="fileTypeMap"><ref bean="mimeTypes"/></property>
	</bean>
	<bean id="viewiCal" parent="dependOnAllModulesTemplate" class="com.sitescape.team.servlet.forum.ViewICalController">
		<property name="icalModule"><ref bean="icalModule"/></property>
		<property name="mailModule"><ref bean="mailModule"/></property>
	</bean>
	<bean id="viewCss" parent="dependOnAllModulesTemplate" class="com.sitescape.team.servlet.forum.ViewCssController"/>
	<bean id="viewDefinitionXml" parent="dependOnAllModulesTemplate" class="com.sitescape.team.servlet.definition.ViewDefinitionXmlController"/>
	<bean id="viewFragment" parent="dependOnAllModulesTemplate" class="com.sitescape.team.servlet.widget_test.FragmentController"/>
	<bean id="reportDownload" parent="dependOnAllModulesTemplate" class="com.sitescape.team.servlet.administration.ReportDownloadController">
		<property name="fileTypeMap"><ref bean="mimeTypes"/></property>
	</bean>
	<bean id="definitionDownload" parent="dependOnAllModulesTemplate" class="com.sitescape.team.servlet.administration.ExportDefinitionDownloadController">
		<property name="fileTypeMap"><ref bean="mimeTypes"/></property>
	</bean>
	<bean id="templateDownload" parent="dependOnAllModulesTemplate" class="com.sitescape.team.servlet.administration.TemplateDownloadController">
		<property name="fileTypeMap"><ref bean="mimeTypes"/></property>
	</bean>
	<bean id="errorHandler" parent="dependOnAllModulesTemplate" class="com.sitescape.team.servlet.forum.ErrorController"/>
	<bean id="readFile" parent="dependOnAllModulesTemplate" class="com.sitescape.team.servlet.forum.ReadFileController">
		<property name="fileTypeMap"><ref bean="mimeTypes"/></property>
	</bean>
	<bean id="portalLogin" parent="dependOnAllModulesTemplate" class="com.sitescape.team.servlet.portal.PortalLoginController">
		<property name="portalLogin"><ref bean="portalLoginBean"/></property>
	</bean>

</beans>
