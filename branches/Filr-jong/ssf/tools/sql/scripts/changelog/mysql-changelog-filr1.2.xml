<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
    
    <changeSet author="jong" context="schema" failOnError="true" id="1">
        <createTable tableName="net_folder_config">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>           
            <column name="lockVersion" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
			<column name="folderId" type="BIGINT">
                <constraints nullable="false"/>
			</column>			
			<column name="netFolderServerId" type="BIGINT">
                <constraints nullable="false"/>
			</column>			
            <column name="resourcePath" type="VARCHAR(1024)">
            	<constraints nullable="true"/>
            </column>
			<column name="homeDir" type="BIT">
                <constraints nullable="true"/>
			</column>			
			<column name="allowDesktopAppToSyncData" type="BIT">
                <constraints nullable="true" />
            </column>
			<column name="allowMobileAppsToSyncData" type="BIT">
                <constraints nullable="true" />
            </column>
            <column name="indexContent" type="BIT">
                <constraints nullable="true" />
            </column>
            <column name="jitsEnabled" type="BIT">
                <constraints nullable="true" />
            </column>
            <column name="jitsMaxAge" type="BIGINT">
                <constraints nullable="true" />
            </column>
            <column name="jitsAclMaxAge" type="BIGINT">
                <constraints nullable="true" />
            </column>
            <column name="fullSyncDirOnly" type="BIT">
                <constraints nullable="true" />
            </column>
            <column name="syncScheduleOption" type="SMALLINT">
                <constraints nullable="true" />
            </column>
            <column name="useInheritedIndexContent" type="BIT">
                <constraints nullable="true" />
            </column>
            <column name="useInheritedJitsSettings" type="BIT">
                <constraints nullable="true" />
            </column>
            <column name="allowDesktopAppToTriggerInitialHomeFolderSync" type="BIT">
                <constraints nullable="true" />
            </column>
            <column name="useInheritedDesktopAppTriggerSetting" type="BIT">
                <constraints nullable="true" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" engine innodb"/>
        </modifySql>
    </changeSet>

    <changeSet author="jong" context="schema" failOnError="true" id="2">
        <createIndex indexName="name_netFolderConfig" tableName="net_folder_config" unique="true">
            <column name="name"/>
        </createIndex>
    </changeSet>

    <changeSet author="jong" context="schema" failOnError="true" id="3">
        <addColumn tableName="SS_Forums">
            <column name="netFolderConfigId" type="BIGINT">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <addColumn tableName="SS_Forums">
            <column name="relRscPath" type="VARCHAR(1024)">
                <constraints nullable="true" />
            </column>
        </addColumn>
	</changeSet>
	
	<changeSet author="jong" context="schema" failOnError="true" id="4">
        <comment>These columns are no longer needed because net_folder_config table assumes the role</comment>
        <dropColumn tableName="SS_Forums" columnName="resourceDriverName"/>
        <dropColumn tableName="SS_Forums" columnName="resourcePath"/>
        <dropColumn tableName="SS_Forums" columnName="homeDir"/>
        <dropColumn tableName="SS_Forums" columnName="allowDesktopAppToSyncData"/>
        <dropColumn tableName="SS_Forums" columnName="allowMobileAppsToSyncData"/>
        <dropColumn tableName="SS_Forums" columnName="indexContent"/>
        <dropColumn tableName="SS_Forums" columnName="jitsEnabled"/>
        <dropColumn tableName="SS_Forums" columnName="jitsMaxAge"/>
        <dropColumn tableName="SS_Forums" columnName="jitsAclMaxAge"/>
        <dropColumn tableName="SS_Forums" columnName="fullSyncDirOnly"/>
        <dropColumn tableName="SS_Forums" columnName="syncScheduleOption"/>
        <dropColumn tableName="SS_Forums" columnName="useInheritedIndexContent"/>
        <dropColumn tableName="SS_Forums" columnName="useInheritedJitsSettings"/>
        <dropColumn tableName="SS_Forums" columnName="allowDesktopAppToTriggerInitialHomeFolderSync"/>
        <dropColumn tableName="SS_Forums" columnName="useInheritedDesktopAppTriggerSetting"/>
    </changeSet>
	
</databaseChangeLog>